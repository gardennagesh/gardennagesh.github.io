<p>/* Please INDENT in Linux by running indent utility on src_file_name */</p>
<p></p>
<p>/*************************************File1: logmsg.h ***************************************************************</p>
<p> This is Headerfile: logmsg.h </p>
<p> Pls look in comments of main.c  to know more about  module based dynamic loger demo.</p>
<p>*********************************************************************************************************************/</p>
<p></p>
<p>#define INFO  0x1</p>
<p>#define WARN  0x2</p>
<p>#define ERROR 0x4</p>
<p>#define DEBUG 0x8</p>
<p>void logmsg(int ltype, char *msg);</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p>/************************************File2: main.c ******************************************************************</p>
<p> This File (main module) : main.c </p>
<p> Header and modules      : 1)logmsg.h  2)main.c  3)logmsg.c    4)abc.c   5)xyz.c  </p>
<p> Programmer              : Nagesh Nanjundachari at garden.nagesh@gmail.com </p>
<p> This programme is just to demonstrate how dynamic-logger-level can be implemented . </p>
<p> Based on random value log levels of  ABC and XYZ modules will change dynamically.</p>
<p>Child send SIGUSR1 to parent at every 5 secs.</p>
<p> This programme is NOT multi-Thread-safe. logmsg function is not thread safe   </p>
<p> USAGE: Copy all module files in a directory and Compile in Linux  as: [YOUR_WORKDIR] cc main.c abc.c xyz.c logmsg.c </p>
<p>*********************************************************************************************************************/</p>
<p></p>
<p>#include&ltstdio.h&gt</p>
<p>#include&ltstdlib.h&gt</p>
<p>#include&ltsignal.h&gt</p>
<p>#include"logmsg.h"</p>
<p></p>
<p>extern int ABC_log_level;</p>
<p>extern int XYZ_log_level;</p>
<p></p>
<p>void get_module_log_settings (int i) {</p>
<p>long val;</p>
<p></p>
<p></p>
<p>/** IPC or Sockets perfectly replace the random-call for User-control from another process. **/</p>
<p>/** For demo purpose, below dynamically change loglevel based on random val is EVEN or ODD. **/</p>
<p>        val = random();</p>
<p>        if (val % 2) {</p>
<p>                printf ("\n Below log levels set in EVEN clause\n");</p>
<p>                ABC_log_level = ( INFO  | DEBUG );</p>
<p>                XYZ_log_level = ( ERROR | WARN  );</p>
<p>        }</p>
<p>        else {</p>
<p>                printf ("\n Below log levels set in ODD clause\n");</p>
<p>                ABC_log_level = ( ERROR | WARN  );</p>
<p>                XYZ_log_level = ( INFO  | DEBUG );</p>
<p>        }</p>
<p>}</p>
<p></p>
<p></p>
<p>main( ) {</p>
<p></p>
<p>        if (!fork()) {</p>
<p>                while (1) {</p>
<p>                        sleep (5);</p>
<p>                        kill (getppid(), SIGUSR1);</p>
<p>                }</p>
<p>        }</p>
<p>        else {</p>
<p>                signal (SIGUSR1, get_module_log_settings);</p>
<p>                while (1) {</p>
<p>                        ABC_func();</p>
<p>                        sleep (10);</p>
<p>                        XYZ_func();</p>
<p>                }</p>
<p>        }</p>
<p>}</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p>/**************************************File3: logmsg.c****************************************************************</p>
<p>This file(logger module) :  logmsg.c</p>
<p>Pls look into main.c for usage.</p>
<p>**********************************************************************************************************************/</p>
<p>#include&ltstdio.h&gt</p>
<p>#include"logmsg.h"</p>
<p></p>
<p>int log_module;</p>
<p>int ABC_log_level;</p>
<p>int XYZ_log_level;</p>
<p></p>
<p>void logmsg(int ltype, char *msg) {</p>
<p></p>
<p>        if ((log_module & INFO) &&  (ltype == INFO ))  {</p>
<p>                printf ("%s\n", msg);</p>
<p>        }</p>
<p>        if ((log_module & WARN) &&  (ltype == WARN))  {</p>
<p>                printf ("%s\n", msg);</p>
<p>        }</p>
<p>        if ((log_module & ERROR) && (ltype == ERROR))  {</p>
<p>                printf ("%s\n", msg);</p>
<p>        }</p>
<p>        if ((log_module & DEBUG) && (ltype == DEBUG))  {</p>
<p>                printf ("%s\n", msg);</p>
<p>        }</p>
<p></p>
<p>}</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p>/************************************File4 abc.C *********************************************************************</p>
<p>This file(one module) :  abc.c</p>
<p>Pls look into main.c for usage.</p>
<p>**********************************************************************************************************************/</p>
<p></p>
<p></p>
<p>#include&ltstdio.h&gt</p>
<p>#include"logmsg.h"</p>
<p></p>
<p>extern int ABC_log_level;</p>
<p>extern int log_module;</p>
<p></p>
<p>int ABC_func (void) {</p>
<p></p>
<p>        log_module=ABC_log_level;</p>
<p></p>
<p>        logmsg( DEBUG, "debug msg  enabled in ABCmod" );</p>
<p>        logmsg( INFO,  "info  msg  enabled in ABCmod"  );</p>
<p>        logmsg( ERROR, "error msg  enabled in ABCmod" );</p>
<p>        logmsg( WARN,  "warn  msg  enabled in ABCmod" );</p>
<p>}</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p>/***********************************File5  xyz.C *********************************************************************</p>
<p>This file(another module) :  xyz.c</p>
<p>Pls look into main.c for usage.</p>
<p>**********************************************************************************************************************/</p>
<p></p>
<p>#include&ltstdio.h&gt</p>
<p>#include"logmsg.h"</p>
<p></p>
<p>extern int XYZ_log_level;</p>
<p>extern int log_module;</p>
<p></p>
<p>int XYZ_func (void) {</p>
<p></p>
<p>        log_module = XYZ_log_level;</p>
<p></p>
<p>        logmsg( DEBUG, "debug msg  enabled in XYZmod" );</p>
<p>        logmsg( INFO,  "info  msg  enabled in XYZmod"  );</p>
<p>        logmsg( ERROR, "error msg  enabled in XYZmod" );</p>
<p>        logmsg( WARN,  "warn  msg  enabled in XYZmod" );</p>
<p>}</p>
<p></p>
<p></p>
<p>/*---------------------------------------------------------------------------------------------------------------------------------*/</p>
<p>/*---------------------------------------------------------------------------------------------------------------------------------*/</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

